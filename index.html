<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Heart to Heart | Atelier ISA</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400&family=Pinyon+Script&display=swap');

    :root {
      --gold: #c5a059;
      --deep-green: #1a2a1d;
      --cream: #f8f5f0;
      --card-white: #ffffff;
      --border-soft: rgba(197, 160, 89, 0.3);
    }

    body {
      background-color: var(--cream);
      color: var(--deep-green);
      font-family: 'Lato', sans-serif;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      background-image: url("https://www.transparenttextures.com/patterns/natural-paper.png");
    }

    .petal {
      position: fixed;
      top: -10%;
      z-index: 1;
      pointer-events: none;
      animation: fall linear infinite;
      background: white;
      border-radius: 150% 0 150% 0;
      opacity: 0.4;
      filter: blur(1px);
    }
    @keyframes fall {
      to { transform: translateY(110vh) rotate(360deg); }
    }

    #app-container {
      text-align: center;
      max-width: 100%;
      z-index: 10;
      padding: 20px;
    }

    .deck-area {
      position: relative;
      height: 300px;
      width: 300px;
      margin: 0 auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .card {
      position: absolute;
      width: 160px;
      height: 230px;
      background: var(--card-white);
      border-radius: 4px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.8s cubic-bezier(0.2, 1, 0.3, 1);
    }
    .card-inner-design {
      position: absolute;
      inset: 12px;
      border: 1px solid var(--gold);
      background-color: var(--deep-green);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card-inner-design svg { width: 40px; fill: var(--gold); opacity: 0.9; }

    #result-screen {
      display: none;
      opacity: 0;
      transition: 1s ease;
    }

    #capture-frame {
      background: var(--card-white);
      padding: 45px;
      width: 350px;
      height: 480px;
      margin: 0 auto;
      position: relative;
      border: 1px solid var(--border-soft);
      box-shadow: 0 40px 80px rgba(0,0,0,0.12);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-image: url("https://www.transparenttextures.com/patterns/paper-fibers.png");
    }

    #capture-frame::before {
      content: '';
      position: absolute;
      inset: 18px;
      border: 0.5px solid var(--gold);
      opacity: 0.4;
      pointer-events: none;
      z-index: 1;
    }

    .isa-header {
      font-size: 0.5rem;
      letter-spacing: 5px;
      color: var(--gold);
      text-transform: uppercase;
      margin-bottom: 15px;
      z-index: 2;
      font-weight: bold;
    }
    .name-section { margin-bottom: 30px; width: 100%; z-index: 2; }
    .for-label {
      font-family: 'Playfair Display', serif;
      font-size: 0.75rem;
      font-style: italic;
      color: #aaa;
    }
    .user-name-input {
      font-family: 'Pinyon Script', cursive;
      font-size: 2.2rem;
      border: none;
      border-bottom: 0.5px solid var(--border-soft);
      text-align: center;
      color: var(--deep-green);
      background: transparent;
      width: 80%;
      outline: none;
      margin-top: 2px;
    }

    .quote-box {
      font-family: 'Playfair Display', serif;
      font-size: 1.3rem;
      font-style: italic;
      line-height: 1.6;
      margin-top: auto;
      padding: 0 25px;
      z-index: 5;
      color: #1a1a1a;
    }
    .quote-author {
      font-size: 0.55rem;
      letter-spacing: 4px;
      text-transform: uppercase;
      opacity: 0.5;
      margin-top: 15px;
      margin-bottom: auto;
      z-index: 5;
    }

    .rec-row {
      width: 100%;
      display: flex;
      justify-content: space-between;
      border-top: 0.3px solid #ddd;
      padding-top: 20px;
      margin-top: 30px;
      text-align: left;
      z-index: 2;
    }
    .rec-label {
      font-size: 0.45rem;
      color: var(--gold);
      letter-spacing: 2px;
      font-weight: 700;
    }
    .rec-val {
      font-family: 'Playfair Display', serif;
      font-size: 0.7rem;
      display: block;
      margin-top: 4px;
      font-style: italic;
    }

    /* === UPDATED: luxury decoration styling === */
    .decoration-svg{
      position:absolute;
      cursor:move;
      z-index:3;
      user-select:none;
      pointer-events:auto;
      mix-blend-mode:multiply;

      width: 82px;
      height: 82px;

      opacity: 0.78;
      filter: saturate(0.95);
      transition: transform 0.08s;
    }
    .decoration-svg.decoration-sparkle{
      width: 34px;
      height: 34px;
      opacity: 0.55;
    }
    .decoration-svg.decoration-seal{
      width: 92px;
      height: 92px;
      opacity: 0.82;
    }
    .decoration-svg.decoration-corner{
      width: 78px;
      height: 78px;
      opacity: 0.72;
    }

    .atelier-toolbar {
      margin-top: 25px;
      display: inline-flex;
      gap: 15px;
      background: rgba(255,255,255,0.95);
      padding: 12px 20px;
      border-radius: 4px;
      border: 0.5px solid var(--gold);
    }
    .tool-btn {
      width: 40px;
      height: 40px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .tool-btn svg { width: 28px; fill: none; stroke: var(--gold); }

    .btn-group { margin-top: 30px; }
    .btn {
      background: none;
      border: 0.5px solid var(--gold);
      padding: 10px 25px;
      text-transform: uppercase;
      letter-spacing: 3px;
      font-size: 0.6rem;
      cursor: pointer;
      transition: 0.3s;
      margin: 0 5px;
    }
    .btn-save { background: var(--gold); color: white; }
    .btn:hover { background: var(--deep-green); color: white; }
    .hint { font-size: 0.55rem; opacity: 0.4; margin-top: 15px; letter-spacing: 2px; text-transform: uppercase; }
  </style>
</head>

<body>
  <div id="app-container">
    <div id="ritual-screen">
      <p style="letter-spacing: 5px; font-size: 0.55rem; opacity: 0.6;">ATELIER ISA CHULALONGKORN</p>
      <h1 style="font-family: 'Pinyon Script', cursive; font-size: 5.5rem; color: var(--gold); margin: 0;">Heart to Heart</h1>
      <p style="letter-spacing: 8px; text-transform: uppercase; font-size: 0.75rem; margin-bottom: 40px;">Divine Selection</p>
      <div class="deck-area" id="deck-container"></div>
      <p id="status-text" style="letter-spacing: 3px; font-size: 0.6rem; margin-top: 30px; opacity: 0.7;">TAP TO SHUFFLE INTENTIONS</p>
    </div>

    <div id="result-screen">
      <div id="capture-frame">
        <div class="isa-header">Atelier ISA Correspondence</div>
        <div class="name-section">
          <span class="for-label">Dedicated to</span><br />
          <input type="text" class="user-name-input" placeholder="Name" maxlength="22" />
        </div>

        <div class="quote-box" id="quote-text"></div>
        <div class="quote-author" id="quote-source"></div>

        <div class="rec-row">
          <div class="rec-item">
            <span class="rec-label">CINEMATIC</span>
            <span class="rec-val" id="movie-title"></span>
          </div>
          <div class="rec-item" style="text-align: right;">
            <span class="rec-label">LITERARY</span>
            <span class="rec-val" id="book-title"></span>
          </div>
        </div>
      </div>

      <!-- === UPDATED TOOLBAR: Royal + Tiny Sparkle === -->
      <div class="atelier-toolbar">
        <div class="tool-btn" onclick="spawnDecoration('seal')" title="Wax Seal">
          <svg viewBox="0 0 24 24">
            <path d="M12 2.6c5.2 0 9.4 4.2 9.4 9.4S17.2 21.4 12 21.4 2.6 17.2 2.6 12 6.8 2.6 12 2.6Z" stroke-width="1.2"/>
          </svg>
        </div>

        <div class="tool-btn" onclick="spawnDecoration('laurel')" title="Laurel Corner">
          <svg viewBox="0 0 24 24">
            <path d="M6 18c3-6 7-9 12-12M6.5 17.5c2.5-4.5 6-7.5 10.8-10.4" stroke-width="1.2"/>
          </svg>
        </div>

        <div class="tool-btn" onclick="spawnDecoration('filigree')" title="Filigree">
          <svg viewBox="0 0 24 24">
            <path d="M6 12c0-2.2 1.8-4 4-4 1 0 2 .4 2.7 1.1M18 12c0 2.2-1.8 4-4 4-1 0-2-.4-2.7-1.1M8 16c-.8 1-2.1 1.6-3.5 1.6M16 8c.8-1 2.1-1.6 3.5-1.6" stroke-width="1.2"/>
          </svg>
        </div>

        <div class="tool-btn" onclick="spawnDecoration('crest')" title="Crest">
          <svg viewBox="0 0 24 24">
            <path d="M12 3l7 3v6c0 5-3.2 8.2-7 9-3.8-.8-7-4-7-9V6l7-3Z" stroke-width="1.2"/>
          </svg>
        </div>

        <div class="tool-btn" onclick="spawnDecoration('sparkle')" title="Sparkle">
          <svg viewBox="0 0 24 24">
            <path d="M12 3l1.2 6.2L20 12l-6.8 2.8L12 21l-1.2-6.2L4 12l6.8-2.8L12 3Z" stroke-width="1.2"/>
          </svg>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn" onclick="location.reload()">Reset</button>
        <button class="btn btn-save" onclick="saveImage()">Download Card</button>
      </div>
      <p class="hint">Double-click to rotate decorations</p>
    </div>
  </div>

  <script>
    const colorPalette = [
      { hex: "#fffdf0", quote: "To love at all is to be vulnerable.", source: "C.S. Lewis", movie: "Shadowlands", book: "The Four Loves" },
      { hex: "#fce3e3", quote: "Everything that frightens us wants our love.", source: "Rainer Maria Rilke", movie: "The Shape of Water", book: "Letters to a Young Poet" },
      { hex: "#f5ead0", quote: "Love is not blind; it sees more, not less.", source: "Erich Fromm", movie: "In the Mood for Love", book: "A Lover's Discourse" },
      { hex: "#e2ede4", quote: "The world is full of magic things.", source: "W.B. Yeats", movie: "Song of the Sea", book: "The Wind Among the Reed" },
      { hex: "#e8e1f5", quote: "It is not necessary to hurry intimacy.", source: "Anne Carson", movie: "Before Sunset", book: "Eros the Bittersweet" }
    ];

    let shuffleState = 0;
    const deck = document.getElementById('deck-container');

    const fleurSVG = `
      <svg viewBox="0 0 24 24">
        <path d="M12,21C11,21 9,20 9,18C9,17 10,16 11,15C8,15 5,14 5,11C5,9 6,5 12,2C18,5 19,9 19,11C19,14 16,15 13,15C14,16 15,17 15,18C15,20 13,21 12,21M12,14C14.5,14 16.5,13 17,11C17,9.5 16,7 12,4.5C8,7 7,9.5 7,11C7.5,13 9.5,14 12,14Z"/>
      </svg>
    `;

    function createDeck() {
      for (let i = 0; i < 8; i++) {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.zIndex = i;
        card.style.transform = `translate(${i * 1}px, ${i * 1}px)`;
        card.innerHTML = `<div class="card-inner-design">${fleurSVG}</div>`;
        card.onclick = () => shuffleState < 3 ? runShuffle() : revealCard();
        deck.appendChild(card);
      }
    }

    function runShuffle() {
      shuffleState++;
      const cards = document.querySelectorAll('.card');
      cards.forEach(c => {
        c.style.transform = `translate(${(Math.random() - 0.5) * 300}px, ${(Math.random() - 0.5) * 300}px) rotate(${(Math.random() - 0.5) * 90}deg)`;
      });
      document.getElementById('status-text').innerText = `SHUFFLING (${shuffleState}/3)`;
      if (shuffleState === 3) setTimeout(fanCards, 700);
    }

    function fanCards() {
      shuffleState = 4;
      const cards = document.querySelectorAll('.card');
      cards.forEach((c, i) => {
        const angle = (i - 3.5) * 12;
        const x = (i - 3.5) * 42;
        c.style.transform = `translate(${x}px, 10px) rotate(${angle}deg)`;
      });
      document.getElementById('status-text').innerText = "SELECT AN INTENTION";
    }

    function revealCard() {
      const data = colorPalette[Math.floor(Math.random() * colorPalette.length)];
      document.getElementById('ritual-screen').style.opacity = '0';
      setTimeout(() => {
        document.getElementById('ritual-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        document.body.style.backgroundColor = data.hex;
        document.getElementById('quote-text').innerText = data.quote;
        document.getElementById('quote-source').innerText = `â€” ${data.source}`;
        document.getElementById('movie-title').innerText = data.movie;
        document.getElementById('book-title').innerText = data.book;
        setTimeout(() => document.getElementById('result-screen').style.opacity = '1', 50);
      }, 800);
    }

    /* === UPDATED: Royal + Sparkle SVG set === */
    const svgPaths = {
      seal: `
        <circle cx="12" cy="12" r="9.2" />
        <circle cx="12" cy="12" r="7.2" opacity="0.7"/>
        <path d="M8.3 15.8L12 6.4l3.7 9.4" />
        <path d="M9.7 12.7h4.6" opacity="0.85"/>
        <path d="M12 16.6c2.8-1.1 4.6-3.2 4.6-5.9" opacity="0.35"/>
        <path d="M12 16.6c-2.8-1.1-4.6-3.2-4.6-5.9" opacity="0.35"/>
      `,
      laurel: `
        <path d="M6.2 17.6c2.4-5.5 6.4-9.2 12.2-12.1" />
        <path d="M7.2 16.6c2.1-4.2 5.5-7.2 10.3-10" opacity="0.75"/>
        <path d="M9.1 14.7c-.9-.2-1.6-.7-2-1.5.9.1 1.7.5 2.2 1.2" opacity="0.75"/>
        <path d="M11 12.8c-.9-.2-1.6-.7-2-1.5.9.1 1.7.5 2.2 1.2" opacity="0.75"/>
        <path d="M13 10.9c-.9-.2-1.6-.7-2-1.5.9.1 1.7.5 2.2 1.2" opacity="0.75"/>
        <path d="M15.1 9c-.9-.2-1.6-.7-2-1.5.9.1 1.7.5 2.2 1.2" opacity="0.75"/>
      `,
      filigree: `
        <path d="M7 14.2c1.2-2.6 3.1-4 5.5-4 1.6 0 2.9.6 3.9 1.7" />
        <path d="M17 9.8c-1.2 2.6-3.1 4-5.5 4-1.6 0-2.9-.6-3.9-1.7" />
        <path d="M8 17c-1.2 0-2.1-.4-2.8-1.1.9-.2 1.7 0 2.5.5" opacity="0.65"/>
        <path d="M16 7c1.2 0 2.1.4 2.8 1.1-.9.2-1.7 0-2.5-.5" opacity="0.65"/>
        <path d="M12 7.6c.6 0 1.1.2 1.5.6-.5.1-1 0-1.4-.3" opacity="0.55"/>
        <path d="M12 16.4c-.6 0-1.1-.2-1.5-.6.5-.1 1 0 1.4.3" opacity="0.55"/>
      `,
      crest: `
        <path d="M12 4.2l6.6 2.8v5.2c0 4.6-2.9 7.4-6.6 8.3-3.7-.9-6.6-3.7-6.6-8.3V7l6.6-2.8Z"/>
        <path d="M9 9.8h6" opacity="0.7"/>
        <path d="M12 8.2v7.8" opacity="0.55"/>
        <path d="M10.2 12.5l1.8 1.4 1.8-1.4" opacity="0.6"/>
      `,
      sparkle: `
        <path d="M12 5l.9 4.7L18 12l-5.1 2.3L12 19l-.9-4.7L6 12l5.1-2.3L12 5Z"/>
        <path d="M18.5 6.5l.4 2 .9.4-2 .4-.4.9-.4-.9-2-.4.9-.4.4-2Z" opacity="0.55"/>
      `
    };

    /* === UPDATED: spawnDecoration with curated placement + classy rotation === */
    function spawnDecoration(type) {
      const container = document.getElementById('capture-frame');
      const wrapper = document.createElement('div');
      wrapper.className = 'decoration-svg';

      if (type === 'sparkle') wrapper.classList.add('decoration-sparkle');
      if (type === 'seal') wrapper.classList.add('decoration-seal');
      if (type === 'laurel' || type === 'filigree') wrapper.classList.add('decoration-corner');

      const W = container.clientWidth;
      const H = container.clientHeight;

      const presets = {
        seal:     { x: W/2 - 46, y: H - 120, r: 0 },
        laurel:   { x: 22,       y: 24,      r: 0 },
        filigree: { x: W - 100,  y: 26,      r: 0 },
        crest:    { x: W - 112,  y: 88,      r: 0 },
        sparkle:  { x: W - 74,   y: 210,     r: 0 }
      };
      const p = presets[type] || { x: W/2 - 40, y: H/2 - 40, r: 0 };

      wrapper.style.left = `${p.x}px`;
      wrapper.style.top  = `${p.y}px`;

      wrapper.innerHTML = `
        <svg viewBox="0 0 24 24" style="width:100%; height:100%;">
          <defs>
            <linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#c5a059;" />
              <stop offset="45%" style="stop-color:#f4e4bc;" />
              <stop offset="100%" style="stop-color:#a67c33;" />
            </linearGradient>
          </defs>
          <g stroke="url(#goldGrad)" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="0.85">
            ${svgPaths[type]}
          </g>
        </svg>
      `;

      const rotationSteps = [0, 8, -8, 15, -15];
      let stepIndex = 0;
      let rot = p.r || 0;

      let active = false, initialX = 0, initialY = 0, xOffset = 0, yOffset = 0;

      wrapper.addEventListener("dblclick", () => {
        stepIndex = (stepIndex + 1) % rotationSteps.length;
        rot = rotationSteps[stepIndex];
        wrapper.style.transform = `translate(${xOffset}px, ${yOffset}px) rotate(${rot}deg)`;
      });

      wrapper.addEventListener("mousedown", (e) => {
        initialX = e.clientX - xOffset;
        initialY = e.clientY - yOffset;
        active = true;
      });

      document.addEventListener("mousemove", (e) => {
        if (!active) return;
        const currentX = e.clientX - initialX;
        const currentY = e.clientY - initialY;
        xOffset = currentX;
        yOffset = currentY;
        wrapper.style.transform = `translate(${xOffset}px, ${yOffset}px) rotate(${rot}deg)`;
      });

      document.addEventListener("mouseup", () => active = false);

      container.appendChild(wrapper);
    }

    function createPetal() {
      const p = document.createElement('div');
      p.className = 'petal';
      p.style.left = Math.random() * 100 + 'vw';
      p.style.width = (Math.random() * 8 + 4) + 'px';
      p.style.height = (Math.random() * 8 + 4) + 'px';
      p.style.animationDuration = (Math.random() * 5 + 5) + 's';
      document.body.appendChild(p);
      setTimeout(() => p.remove(), 8000);
    }
    setInterval(createPetal, 700);

    function saveImage() {
      html2canvas(document.getElementById('capture-frame'), { scale: 3, useCORS: true }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'Atelier_ISA_Private_Correspondence.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    }

    createDeck();
  </script>
</body>
</html>
